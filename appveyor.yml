version: 2.1.2-{build}
platform: x64
configuration: Release
image: Visual Studio 2019
environment:
  portable_dir: %APPVEYOR_BUILD_FOLDER%\%APPVEYOR_PROJECT_ID%_%APPVEYOR_BUILD_VERSION%_portable
install:
  - set QTDIR=C:\Qt\5.15.2\msvc2019_64
  - set PATH=%PATH%;%QTDIR%\bin
before_build:
  - call "%QTDIR%/bin/qtenv2.bat"
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars64.bat"
  - cd %APPVEYOR_BUILD_FOLDER%
build_script:
  - qmake ghostwriter.pro
  - nmake release
  - mkdir %portable_dir%
  - cp build\release\ghostwriter.exe %portable_dir%
  - cp -r build\release\translations %portable_dir%
  - cd %portable_dir%
  - windeployqt ghostwriter.exe
after_build:
  - cd %portable_dir%
branches:
  only: 
  - master
artifacts:
  - path: %portable_dir%
    name: deploy files
    type: zip

skip_non_tags: false
shallow_clone: true
